<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞</title>
  <link rel="stylesheet" href="{% static 'myapp/styles.css' %}">
</head>
<body class="page">
  <main class="card">
    <h1>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, 18+?</h1>

    <form id="ageForm">
      <label>–í–æ–∑—Ä–∞—Å—Ç (—á–∏—Å–ª–æ):
        <input type="number" name="age" id="ageInput" min="0" />
      </label>

      <div class="or">–∏–ª–∏</div>

      <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (YYYY-MM-DD):
        <input type="date" name="birthdate" id="birthdateInput" />
      </label>

      <button type="submit" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </form>

    <div id="result" class="result" aria-live="polite"></div>
  </main>

  <script>
    const form = document.getElementById('ageForm');
    const resultEl = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      resultEl.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";

      const formData = new FormData(form);
      // fetch POST (—Ñ–æ—Ä–º–æ–π, –±–µ–∑ JSON)
      const resp = await fetch("", {
        method: "POST",
        body: formData,
        headers: {
          "X-Requested-With": "XMLHttpRequest"
        }
      });

      const data = await resp.json().catch(()=> null);
      if (!data) {
        resultEl.textContent = "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞.";
        return;
      }
      if (!resp.ok) {
        resultEl.textContent = data.message || "–û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.";
        return;
      }

      if (data.is_adult) {
        resultEl.innerHTML = `<span class="ok">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${data.age} –ª–µ—Ç ‚Äî 18+ ‚úÖ</span>`;
      } else {
        resultEl.innerHTML = `<span class="no">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${data.age} –ª–µ—Ç ‚Äî –º–µ–Ω—å—à–µ 18 üö´</span>`;
      }
    });
  </script>
</body>
</html>
